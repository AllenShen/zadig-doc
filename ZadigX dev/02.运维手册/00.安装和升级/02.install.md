---
title: 正式安装与升级
date: 2023-04-21 09:59:31
permalink: /ZadigX dev/stable/install/
---

本文档主要介绍企业如何正式安装 ZadigX，其中包括资源准备及详细的安装步骤。

## 资源准备

1. Kubernetes 集群，版本：v1.16 ~ v1.26，节点建议：2 台 8C16G，且对该集群有管理员操作权限
2. 可正常连通上述 K8s 集群，且安装了 [kubectl](https://kubernetes.io/docs/tasks/tools/) 客户端的机器，用于执行安装命令
3. 网络：
    - 如果选择 IP+端口 的方式访问 ZadigX 系统，需要确保集群节点有外部 IP 可供访问
    - 如果选择域名方式访问 ZadigX 系统，需要准备可用的域名
4. 数据库：
    - 高可用的 MongoDB（版本： v3.4+）
    - 高可用的 MySQL（版本：v5.7+）

::: tip 自建集群注意事项
1. 在安装之前，需要配置 Kubernetes 默认的 StorageClass，以支持创建 PVC 用于数据持久化<br>
2. 配置 kube-dns 服务，以支持服务和 Pod 之间的按名称寻址
:::

## 安装

::: tip
官方为企业管理员提供了便利的运维通道，可在线实施 ZadigX 的安装与日常版本的升级运维，联系官方获取相应的支持。
:::

### 第一步：选择版本

访问客户控制台 > `版本`，点击`发现新版本`获取 ZadigX 的所有版本，按需选择版本后点击`部署`进入参数配置页面。

![安装](../_images/install_1.png)

### 第二步：配置参数

设置安装参数后点击`部署`。

> 安装过程受硬件配置和网络情况影响，不同环境下的时间可能不同，可以执行 kubectl -n {ZadigX 所在的 Namespace} get pod 查询服务状态，当所有服务都是 RUNNING 状态时，则说明部署成功。

![安装](../_images/install_2.png)

参数说明：

- `命名空间`：选择安装 ZadigX 的命名空间
- `Release 名称`：可自定义
- `Helm values 文件`：配置 ZadigX 的相关安装参数
    - 支持手动输入和指定 key/value 两种方式来配置
    - [点我](#安装参数说明)查看安装参数说明

### 第三步：配置许可证

待 ZadigX 成功部署后，访问 ZadigX 系统，输入许可证保存后，使用管理员账号登录即可。

::: tip
管理员账号：admin<br>管理员密码：默认为 zadig，安装时可指定
:::

![安装](../_images/install_3.png)

## 升级

::: warning
升级前请务必做好数据备份，参考文档：[备份数据](/ZadigX%20dev/stable/backup-and-restore/#数据备份)。
:::

访问客户控制台 > `版本`，点击`发现新版本`获取 ZadigX 的新版本，按需选择新版本后点击`部署`。

![安装](../_images/install_1.png)

按需配置参数后部署即可。

> 配置参数可参考文档：[参数配置](#第二步配置参数)。

![安装](../_images/install_2.png)

## 安装参数说明

### 通用安装参数

| 参数名 | 必填              | 备注 | 
|--------|-----------------------------|---------|--------|
| global.extensions.extAuth.extauthzServerRef.namespace | 是 | ZadigX 安装所在的 Namespace | 
| endpoint.FQDN |  使用域名访问 ZadigX 时必填 | 访问 ZadigX 系统的完整 URL | 
| endpoint.type | 使用 IP+Port 访问 ZadigX 时必填 | 设置为固定值: IP |
| endpoint.IP | 使用 IP+Port 访问 ZadigX 时必填 | K8s 节点任一可外网访问的 IP |
| gloo.gatewayProxies.gatewayProxy.service.httpNodePort |使用 IP+Port 访问 ZadigX 时必填|指定的端口号 < 30000 - 32767> |
| gloo.gatewayProxies.gatewayProxy.service.type | 使用 IP+Port 访问 ZadigX 时必填 | 固定值:  NodePort|
| dex.config.staticClients[0].redirectURIs[0] | 是 | 使用域名方式访问：`http://${endpoint.FQDN}/api/v1/callback`<br>使用 IP+Port 方式访问: `http://${IP}:${PORT}/api/v1/callback`|
| init.adminEmail | 否，默认为 admin@koderover.com| 管理员账号的邮箱 |
| init.adminPassword | 否，默认为 zadig| 管理员账号的密码 |

### 高可用安装参数

如果安装高可用 ZadigX，还需配置以下参数：

> 高可用版本使用外置的 MongoDB, MySQL 组件，数据持久化以及高可用性由具体的 MongoDB, MySQL 服务提供商保障

| 参数名 | 必填              | 备注 | 
|--------|-----------------------------|---------|--------|
| tags.mysql |是 | 是否安装内置的 MySQL，指定为 false| 
| connections.mysql.host |是 | MySQL 连接地址 |
| connections.mysql.auth.user | 是 | MySQL 用户名 |
| connections.mysql.auth.password | 是| MySQL 密码|
| dex.config.storage.config.host | 是| Dex 系统所使用的 MySQL Host|
| dex.config.storage.config.port|是|Dex 系统所使用的 MySQL 端口|
|dex.config.storage.config.user|是|Dex 系统所使用的 MySQL 用户名|
|dex.config.storage.config.password|是|Dex 系统所使用的 MySQL 密码|
| tags.mongodb | 是 | 是否安装内置的 MongoDB，指定为 false |
| connections.mongodb.connectionString | 是 | MongoDB 数据库连接串，配置多个地址时需要进行转义，比如：`mongodb://user:password@8.10.20.20\,8.10.20.30`|
|ee.mongodb.db|是| MongoDB 数据库名称|