---
title: 使用指南
date: 2021-09-09 20:14:25
permalink: /dev/zadig-toolkit/overview/
---

Zadig Toolkit 是 KodeRover 旗下开源产品 Zadig 的 Visual Studio Code 插件。
该插件让开发者无需关注平台切换的繁琐，在 IDE 中即可获得 Zadig 产品核心能力，轻松地对 Zadig 项目中的 Kubernetes 环境进行查看、做服务调试和升级、重启及日志实时查看等。
在日常开发代码过程，代码修改后无需提交到 Git 仓库，也无需打包镜像，即可将服务热部署到 Zadig 云端，方便开发者做服务自测、联调和集成验证。
目前 Zadig Toolkit 支持的功能如下：
- Zadig 环境查看
- 微服务重启、服务详情查看、服务镜像更换、Pod 实时日志查看
- 远程调试本地应用程序
<!-- - 远程开发容器配置，远程调试本地应用程序 -->

## 准备工作
- 系统准备：[安装 Zadig v1.12.0+ 版本](https://docs.koderover.com/zadig/install/overview/)
- 项目准备：参考[如何使用 GitHub + Zadig 实现产品级持续交付](https://www.koderover.com/tutorials/codelabs/GitHub/index.html?index=..%2F..index#0)

## 安装插件
- 打开 Visual Studio Code 并进入应用市场。
- 在应用市场中搜索 `Zadig Toolkit`，查看详情并安装。

![plugin-install](./_images/plugin_install.png)

## 配置插件
1. 打开已安装的 Zadig Toolkit 插件。
2. 点击`设置`进入插件配置页。

![plugin-setting](./_images/plugin_setting_1.png)
![plugin-setting](./_images/plugin_setting_2.png)

**配置参数说明：**
1. Zadig 部署地址：请根据实际协议，填写完整的 URI，例如：`http://zadig.com`。
2. Zadig API Token：进入 Zadig 系统，点击`账号设置`，如下图所示。

![plugin-setting](./_images/plugin_setting_3.png)

配置完成后，可在左侧栏看到 Zadig 系统中的项目。

![plugin-setting](./_images/plugin_setting_4.png)

## 如何使用
### 远程调试本地代码

下面以准备好的 `voting-demo` 项目为例，介绍如何通过 Zadig Toolkit 进行远程调试。

- 选择 `voting-demo` 项目 -> `dev` 环境，点击环境右侧图标设置 Kube Config（即：dev 环境所在集群的 config 配置文件），可在文件目录中选择该配置文件或手动输入其路径后回车。

![plugin-setting](./_images/kube_config_set.png)

- 选择 `vote` 服务，点击调试按钮进入开发模式。

![debug-service](./_images/debug_service_vote_1.png)

- 选择本地开发代码目录，本例中为 [koderover/zadig](https://github.com/koderover/zadig) -> examples -> voting-app。

![debug-service](./_images/debug_service_vote_2.png)
![debug-service](./_images/debug_service_vote_3.png)

- 选择开发环境使用的基础镜像 `python:3.10.4-buster`。

![debug-service](./_images/debug_service_vote_4.png)
![debug-service](./_images/debug_service_vote_5.png)

- 稍等片刻待开发模式启动执行完毕后，进入开发容器 `dev`，所选目录中内容将自动同步到开发容器中。

![debug-service](./_images/debug_service_vote_6.png)
![debug-service](./_images/debug_service_vote_7.png)

- 修改本地代码并保存：修改第一个投票按钮的背景颜色。

![debug-service](./_images/debug_service_vote_8.png)

- 改动的代码会自动同步到远端 `dev` 开发环境。在终端中进入 `vote` 目录，执行启动命令。

```bash
pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/
gunicorn app:app -b 0.0.0.0:80 --log-file - --access-logfile - --workers 4 --keep-alive 0
```

![debug-service](./_images/debug_service_vote_9.png)

- 访问 vote 服务地址，修改结果如下图所示。

![debug-service](./_images/debug_service_vote_10.png)

- 点击红色按钮，确定结束开发模式，容器恢复正常。

![debug-service](./_images/debug_service_vote_11.png)
![debug-service](./_images/debug_service_vote_12.png)

至此一个完整的本地调试流程演示完毕。

### 查看环境和服务

日常联调测试过程中，需要对服务进行诊断，通过 Zadig Toolkit 可以查看服务的状态，重启服务，更换服务镜像，查看服务的实时日志等。

- 点击服务镜像右侧的修改图标可修改服务镜像。

![detail_env_info](./_images/detail_env_info_1.png)

- 点击服务配置，可以查看服务的基本信息，点击`实时日志`对服务的日志进行查看。

![detail_env_info](./_images/detail_env_info_2.png)

- 右键点击服务，点击`重启服务`可以对服务进行重启。

![detail_env_info](./_images/detail_env_info_3.png)


<!-- ### 配置远程开发环境
通过 Zadig Toolkit 插件亦可对远程开发环境进行配置。
- 点击`vote`服务右侧的 <img style="width:15px; height:15px" src="./_images/devmode_container_setting_avatar.svg"></img> 图标。

![devmode_contaniner_setting](./_images/devmode_contaniner_setting.png)
- 替换`vote-rc-origin.yaml`内容，修改`env`环境变量。

```
name: vote-rc-origin
serviceType: deployment
containers:
  - name: vote-e2e
    dev:
      gitUrl: ""
      image: ""
      shell: ""
      workDir: /home/nocalhost-dev
      storageClass: ""
      resources: null
      persistentVolumeDirs: []
      command: null
      debug: null
      useDevContainer: false
      sync: null
      env:
        - name: GO111MODULE
          value: "on"
        - name: GOPROXY
          value: https://goproxy.cn,direct
      portForward: []
      sidecar_image: ""
```
- 重新进入开发模式，执行 `env | grep -E 'GO111MODULE|GOPROXY'` 命令查看环境变量的值，可发现配置生效。

![plugin-services](./_images/plugin_dev_config_effect.png)

- 配置设置后，即可基于新的环境配置对本地代码进行远程调试。 -->
